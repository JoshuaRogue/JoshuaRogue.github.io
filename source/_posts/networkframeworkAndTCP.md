---
title: 网络分层及TCP、HTTP协议
date: 2018-02-08 14:43:14
categories: Android网络开发
---

> 在Android中的网络编程中，我们需要了解基本的网络分层和最主要的几个协议

### 网络分层

在我所学的《计算机网络》课本中，将网络分为物理层、数据链路层、网络层、传输层与应用层，这是一个自底而上的顺序，叫做五层协议体系模型；而在OSI七层体系模型中，则把应用层又分为了会话层、表示层与应用层，具体为：

> 物理层、数据链路层、网络层、传输层、会话层、表示层、应用层

TCP协议是属于传输层的协议，而HTTP协议在两个分层中都是属于应用层协议

### TCP

#### 三次握手

我们进行HTTP连接网络时会进行TCP的三次握手，然后传输数据，之后再释放连接，过程如下：

1. 第一次握手：客户端向服务端发送SYN请求报文段，进入SYN_SENT状态
2. 第二次握手：服务器收到客户端发来的SYN请求报文段，发送SYN+ACK报文段，进入SYN_REVD状态
3. 第三次握手：客户端收到服务端的SYN+ACK报文段，向服务器发送ACK报文段，发送完毕后，客户端和服务器都进入ESTABLISHED状态

#### 四次挥手

建立连接后，当数据传送完毕，断开连接我们就需要进行四次挥手：

1. 第一次挥手：客户端向服务端发送FIN报文段，进入FIN_WAIT_1状态，此时客户端已经没有数据需要发送给服务端了
2. 第二次挥手：服务端收到了客户端发送的FIN报文段，向客户端发送ACK报文段
3. 第三次挥手：服务端发送FIN报文段，进入LAST_ACK状态
4. 第四次挥手：客户端收到服务端发送的FIN报文段，向服务端发送ACK报文段，服务端收到ACK报文后就关闭连接。客户端在等待最大报文生存时间后没有收到回复，客户端也关闭连接

### HTTP

HTTP是应用层的协议，它假定在下层的协议是可靠的，所以我们一般使用TCP/IP协议作为它的下层协议来使用

#### HTTP请求方法

* GET：请求获取Request-URI所标识的资源
* POST：在Request-URI所标识的资源后附加新的数据
* HEAD：请求获取由Request-URI所标识的资源的相应消息报头
* PUT：请求服务器存储一个资源，并用Request-URI作为其标识
* DELETE：请求服务器删除Request-URI所标识的资源
* TRACE：请求服务器回送收到的请求消息，用于测试或诊断
* CONNECT：在1.1版本中将连接改为管道方式的代理服务器
* OPTIONS：请求查询服务器的性能，或者查询与资源相关的选项和需求

#### HTTP响应状态码：

* 1XX：指示信息，收到请求，需要请求者继续执行操作
* 2XX：请求成功，请求已成功被处理
* 3XX：重定向，要完成请求必须进行更进一步的操作
* 4XX：客户端错误，请求有语法错误或无法实现
* 5XX：服务器错误，服务器不能实现合法的请求

#### HTTP消息报头

HTTP消息报头又分为通用报头、请求报头、响应报头、实体报头等

##### 通用报头

> 通用报头既可以出现在请求报头，也可以出现在响应报头中

* Date：表示消息产生的日期和时间
* Connection：允许发送指定连接的选项。
* Cache-Control：用于指定缓存指令

##### 请求报头

> 请求报头通知服务器关于客户端请求的信息

* Host：请求的主机名，允许多个域名同处一个ip地址，即虚拟主机
* User-Agent：发送请求的浏览器类型、操作系统等信息
* Accept：客户端可识别的内容类型列表，用户指定客户端接收哪些类型的信息
* Accept-Encoding：客户端可识别的数据编码
* Accept-Language：表示浏览器支持的语言类型
* Connection：允许客户端和服务器于指定与请求/响应连接有关的选项
* Transfer-Encoding：告知接收端为了保证报文的可靠传输，对报文采用了什么编码方式

##### 响应报头

> 用于服务器传递自身信息的响应

* Location：用于重定向接收者到一个新的位置，常用在更换域名的时候
* Server：包含服务器用来处理请求的系统信息，与User-Agent请求报头是向对应的

##### 实体报头

> 实体报头用来定义被传送资源的信息，其既可以用于请求也可以用于响应，请求和响应消息都可以传送一个实体

* Content-Type：发送给接收者的实体正文的媒体类型
* Content-Length：实体正文的长度
* Content-Language：描述资源所用的自然语言
* Content-Encoding：实体报头被用作媒体类型的修饰符
* Last-Modified：实体报头用于只是资源的最后修改日期和时间
* Expires：实体报头给出响应过期的日期和时间
---
title: 传输层协议：UDP与TCP
date: 2018-11-08 15:41:14
categories: Android网络开发
---

协议 | 特点 | 应用
--- | --- | ---
UDP | 无连接，给应用提供发送数据包功能并允许它们在所需的层次之上架构自己的协议 | 客户-服务器交互和多媒体应用
TCP | 面向连接，建立连接并通过重传机制增加了可靠性，同时还进行流量控制和拥塞控制，为使用它的应用程序做了所有的一切 | 为大多数Internet应用提供可靠的、按序递交的传输

#### UDP

UDP（用户数据包协议）为应用程序提供了一种无需建立连接就可发送封装的IP数据包的方法。

##### UDP的段

UDP传输的段由8字节的头和有效载荷字段构成。头信息中包含的两个端口（port）分别用来标识源机器和目标机器内部的端点。当一个UDP数据包到来时，它的有效载荷被递交给与目标端口相关联的哪个进程。采用UDP而不是原始IP的最主要价值在于增加了源端口和目标端口。

UDP段中还包含了一个可选的校验和来提供额外的可靠性，当不使用校验和时，则将该字段填为0。

##### 功能总结

UDP只是提供了一个与IP协议的接口，并在此接口上通过端口号复用多个进程的功能，以及可选的端到端错误检测功能。

##### 应用领域

###### 客户机-服务器开发

客户端向服务器发送一个简短的请求报文，并期待来自服务器的简短服务报文。如果请求或回复报文丢失，客户端就会超时，然后再试一次。

> 同时，这也是RPC（远程过程调用）的基础

###### 域名系统

一个程序需要查询某个主机名的IP地址，那么它可以给DNS服务器发送一个包含该主机名的UDP数据包。服务器用一个包含了该主机IP地址的UDP数据包作为应答。实现不需要建立连接，事后也不需要释放连接。只有两条消息通过网络就够了。

###### 多媒体

RTP（实时传输协议）与RTCP（实时传输控制协议）都是位于UDP之上的协议，广泛应用于多媒体应用程序。

#### TCP

TCP（传输控制协议）是为了在不可靠的互联网上提供端到端字节流而专门设计的一个传输协议。

##### TCP段

TCP段由一个固定大小的20字节的头以及随后0个或者多个数据字节构成。TCP软件决定了段的大小。它可以将多次写操作中的数据累计起来，放到一个段中发送。有两个因素限制了段的长度。首先，包括TCP头在内的每个段，必须适合IP的65515个字节有效载荷；其次，每个网络都有一个最大传输单元（MTU）。发送端和接收端的每个段必须适合MTU，才能以单个不分段的数据包发送和接收。然而，当IP数据包穿过一条网络路径，其上某条链路有更小的MTU时，还是有可能要对携带TCP段的该IP数据包实行分段操作。TCP实体使用的基本协议是具有动态窗口大小的滑动窗口协议。当发送端传送一段时，它启动一个计时器。当该端到达接收方时，接收端的TCP实体返回一个携带确认号和剩余窗口大小的段，并且确认号的指等于接收端期望接收的下一个序号。如果发送端的计时器在确认段到达之前超时，则发送端再次发送原来的段。

###### TCP段的头

TCP段的结构如图所示。每个段的起始部分是一个固定格式的20字节头。固定的头部之后可能有头的选项。如果该数据段有数据部分的话，那么在选项之后是最多可达65535 - 20 -20 = 65495个字节的数据，这里的第一个20是指IP头，第二个20指TCP头。没有任何数据的TCP段也是合法的，通常被用作确认和控制消息。

![捕获.PNG](https://i.loli.net/2018/11/09/5be54f222d225.png)

* 源端口（Source port）和目标端口（Destination port）字段标识了连接的本地端点。TCP端口加上所在主机的IP地址组成了48位的唯一端点。

* 序号（Sequence number）和确认号（Acknowledgement number）字段执行它们的常规功能。请注意，后者指定的是下一个期待的字节，而不是已经正确接收到的最后一个字节。它是累计确认（cumulative acknowledgement），因为它用一个数字概括了接收到的所有数据，它不会超过丢失的数据。这两个字段都是32位长，因为一个TCP流中的每一个数据字节都已经被编号了。




